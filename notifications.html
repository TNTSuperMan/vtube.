<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>通知</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body>
  <h1>通知一覧</h1>
  <div id="notifications"></div>

  <script>
    const supabaseUrl = "https://yvxynwjfngvqwjjsqdma.supabase.co";
    const supabaseKey = "YOUR_KEY_HERE"; // ←いずみのキー貼ってね
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    let currentUser = null;

    async function checkLogin() {
      const { data } = await supabase.auth.getUser();
      if (!data.user) {
        window.location.href = "login.html";
      } else {
        currentUser = data.user;
      }
    }

    async function loadNotifications() {
      const { data, error } = await supabase
        .from("notifications")
        .select("*, from_user_id, posts(content)")
        .eq("user_id", currentUser.id)
        .order("created_at", { ascending: false });

      if (!error) {
        const div = document.getElementById("notifications");
        div.innerHTML = "";
        data.forEach(n => {
          let text = "";
          if (n.type === "like") {
            text = `ユーザー${n.from_user_id} があなたの投稿にいいねしました`;
          } else if (n.type === "comment") {
            text = `ユーザー${n.from_user_id} があなたの投稿にコメントしました`;
          }
          div.innerHTML += `<p>${text}</p>`;
        });
      }
    }

    async function markAsRead() {
      await supabase
        .from("notifications")
        .update({ read: true })
        .eq("user_id", currentUser.id)
        .eq("read", false);
    }

    checkLogin().then(async () => {
      await loadNotifications();
      await markAsRead();
    });
  </script>
</body>
</html>
